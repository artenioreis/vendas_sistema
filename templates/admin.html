{% extends "base.html" %}

{% block title %}Dashboard Administrador{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">游녬 Painel Administrativo</h2>
            <div class="controls" style="display: flex; gap: 15px; align-items: center;">
                <a href="{{ url_for('admin_dashboard', mostrar_inativos=0 if mostrar_inativos else 1) }}" 
                   class="btn" 
                   style="background: {{ '#e74c3c' if mostrar_inativos else '#95a5a6' }}; color: white; text-decoration: none;">
                    {{ 'Ocultar Inativos' if mostrar_inativos else 'Mostrar Inativos' }}
                </a>
            </div>
        </div>
        <div class="total-stats">
            <span class="total-stat">Total Meta: R$ {{ "%.2f"|format(chart_data.total_meta) }}</span>
            <span class="total-stat">Total Realizado: R$ {{ "%.2f"|format(chart_data.total_realizado) }}</span>
            <span class="total-stat">Total Comiss칚o: R$ {{ "%.2f"|format(chart_data.total_comissao) }}</span>
        </div>
    </div>
    
    <div class="card">
        <h3 class="card-title">游늳 Desempenho Geral</h3>
        <div class="chart-container">
            <canvas id="overallChart"></canvas>
        </div>
    </div>
    
    <div class="card">
        <h3 class="card-title">游논 Lista de Vendedores</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>C칩digo</th>
                        <th>Nome</th>
                        <th>Meta (R$)</th>
                        <th>Realizado (R$)</th>
                        <th>Comiss칚o (R$)</th>
                        <th>% Atingido</th>
                        <th>Status</th>
                        <th>Supervisor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for v in vendedores %}
                    <tr style="{{ 'opacity: 0.6; background: #f9f9f9;' if v.Situacao == 'INATIVO' else '' }}">
                        <td>{{ v.Codigo }}</td>
                        <td>{{ v.Nome_Guerra }}</td>
                        <td>{{ "%.2f"|format(v.Vlr_Objetivo or 0) }}</td>
                        <td>{{ "%.2f"|format(v.Vlr_Realizado or 0) }}</td>
                        <td>{{ "%.2f"|format(v.Vlr_Comissao or 0) }}</td>
                        <td>
                            {% set percent = ((v.Vlr_Realizado or 0) / (v.Vlr_Objetivo or 1) * 100) %}
                            <span class="percent-badge {{ 'success' if percent >= 100 else 'warning' if percent >= 70 else 'danger' }}">
                                {{ "%.1f"|format(percent) }}%
                            </span>
                        </td>
                        <td>
                            <span class="status-badge {{ 'ativo' if v.Situacao == 'ATIVO' else 'inativo' }}">
                                {{ v.Situacao }}
                            </span>
                        </td>
                        <td>{{ v.Cod_Supervisor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card">
        <h3 class="card-title">游늵 Comparativo por Vendedor</h3>
        <div class="chart-container">
            <canvas id="vendedoresChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gr치fico Geral
    const overallCtx = document.getElementById('overallChart').getContext('2d');
    new Chart(overallCtx, {
        type: 'pie',
        data: {
            labels: ['Meta', 'Realizado', 'Comiss칚o'],
            datasets: [{
                data: [
                    {{ chart_data.total_meta }},
                    {{ chart_data.total_realizado }},
                    {{ chart_data.total_comissao }}
                ],
                backgroundColor: ['#3498db', '#2ecc71', '#f39c12']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
    
    // Gr치fico de Vendedores
    const vendedoresCtx = document.getElementById('vendedoresChart').getContext('2d');
    new Chart(vendedoresCtx, {
        type: 'bar',
        data: {
            labels: {{ chart_data.vendedores | map(attribute='nome') | list | tojson }},
            datasets: [
                {
                    label: 'Meta',
                    data: {{ chart_data.vendedores | map(attribute='meta') | list | tojson }},
                    backgroundColor: '#3498db',
                    hidden: true
                },
                {
                    label: 'Realizado',
                    data: {{ chart_data.vendedores | map(attribute='realizado') | list | tojson }},
                    backgroundColor: '#2ecc71'
                },
                {
                    label: 'Comiss칚o',
                    data: {{ chart_data.vendedores | map(attribute='comissao') | list | tojson }},
                    backgroundColor: '#f39c12'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { stacked: false },
                y: { beginAtZero: true }
            }
        }
    });
});
</script>

<style>
.total-stats {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 10px;
}
.total-stat {
    background: white;
    padding: 8px 15px;
    border-radius: 5px;
    font-weight: bold;
    color: #2c3e50;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border: 1px solid #eee;
}
.percent-badge {
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 12px;
    font-weight: bold;
}
.percent-badge.success { background: #d4edda; color: #155724; }
.percent-badge.warning { background: #fff3cd; color: #856404; }
.percent-badge.danger { background: #f8d7da; color: #721c24; }
.status-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}
.status-badge.ativo { background: #d4edda; color: #155724; }
.status-badge.inativo { background: #f8d7da; color: #721c24; }
</style>
{% endblock %}